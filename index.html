<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Birthday Special</title>
    <style>
        :root {
            --cosmic-primary: #000428;
            --cosmic-secondary: #004e92;
            --cosmic-accent: #b794f6;
            --cosmic-glow: #9f7aea;
            --cosmic-text: #f0e6ff;
            --scroll-progress: 0;
            --mouse-x: 50%;
            --mouse-y: 50%;
            --hue-shift: 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(
                180deg, 
                hsl(223, calc(100% - var(--scroll-progress) * 20%), calc(8% + var(--scroll-progress) * 5%)),
                hsl(209, calc(100% - var(--scroll-progress) * 30%), calc(29% + var(--scroll-progress) * 10%))
            );
            min-height: 100vh;
            font-family: 'Georgia', serif;
            color: #ffffff;
            overflow-x: hidden;
            position: relative;
        }

        /* Performance Stats */
        .perf-stats {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            border-radius: 8px;
            z-index: 10000;
            pointer-events: none;
            opacity: 0.8;
            line-height: 1.6;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        .perf-stats div {
            margin: 2px 0;
        }

        .perf-stats .metric {
            color: #00ff00;
        }

        .perf-stats .value {
            color: #ffff00;
            font-weight: bold;
        }

        .perf-stats .warning {
            color: #ff6b6b;
        }

        .perf-stats .good {
            color: #51cf66;
        }

        /* Entry Overlay */
        .entry-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(
                ellipse at var(--mouse-x) var(--mouse-y), 
                #1b2735 0%, 
                #090a0f 100%
            );
            z-index: 9999;
            display: grid;
            place-items: center;
            transition: opacity 2s cubic-bezier(0.4, 0, 0, 1), 
                        transform 2s cubic-bezier(0.4, 0, 0, 1);
            will-change: opacity, transform;
        }

        .entry-overlay.hidden {
            opacity: 0;
            transform: scale(1.05);
            pointer-events: none;
        }

        .entry-content {
            text-align: center;
            animation: breathe 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.02); }
        }

        .entry-title {
            font-size: clamp(1.5em, 4vw, 2.5em);
            margin-bottom: 20px;
            background: linear-gradient(
                90deg,
                var(--cosmic-text),
                var(--cosmic-accent),
                var(--cosmic-glow),
                var(--cosmic-accent),
                var(--cosmic-text)
            );
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
            letter-spacing: 2px;
        }

        @keyframes shimmer {
            to { background-position: 200% center; }
        }

        .entry-subtitle {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 40px;
            font-style: italic;
        }

        .enter-button {
            padding: 15px 40px;
            font-size: 1.1em;
            background: transparent;
            border: 1px solid rgba(183, 148, 246, 0.3);
            color: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
        }

        .enter-button::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(
                circle at var(--mouse-x) var(--mouse-y),
                rgba(183, 148, 246, 0.2),
                transparent 70%
            );
            opacity: 0;
            transition: opacity 0.3s;
        }

        .enter-button:hover::after {
            opacity: 1;
        }

        .enter-button:hover {
            border-color: rgba(183, 148, 246, 0.6);
            color: white;
            transform: translateY(-2px);
        }

        /* Optimized Canvas Background */
        #starCanvas {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0;
            transition: opacity 3s ease;
            will-change: transform;
            transform: translateZ(0);
        }

        #starCanvas.visible {
            opacity: 1;
        }

        /* Sparkle Canvas */
        #sparkleCanvas {
            position: fixed;
            inset: 0;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease;
        }

        #sparkleCanvas.visible {
            opacity: 1;
        }

        /* Mouse Trail Canvas */
        #trailCanvas {
            position: fixed;
            inset: 0;
            z-index: 4;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease;
        }

        #trailCanvas.visible {
            opacity: 1;
        }

        /* Floating Orbs Canvas */
        #orbCanvas {
            position: fixed;
            inset: 0;
            z-index: 3;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease;
        }

        #orbCanvas.visible {
            opacity: 1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 10;
            opacity: 0;
            transform: translateY(30px);
            transition: all 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Header */
        h1 {
            font-size: clamp(1.8em, 5vw, 3em);
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(
                135deg,
                var(--cosmic-text),
                var(--cosmic-accent),
                var(--cosmic-glow)
            );
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 30px rgba(159, 122, 234, 0.5));
            line-height: 1.3;
            opacity: 0;
            animation: fadeInScale 1s forwards 0.5s;
        }

        @keyframes fadeInScale {
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
        }

        /* Birthday Date Display */
        .birthday-date {
            text-align: center;
            margin: 20px auto 30px;
            padding: 15px 30px;
            max-width: 400px;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.03),
                rgba(255, 255, 255, 0.08)
            );
            border-radius: 15px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            animation: fadeInScale 1s forwards 0.6s;
        }

        .birthday-date .day {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(
                90deg,
                #ffd89b,
                var(--cosmic-accent),
                var(--cosmic-glow)
            );
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .birthday-date .message {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
            font-style: italic;
        }

        /* Audio Container */
        .audio-container {
            text-align: center;
            margin: 30px auto;
            padding: 25px;
            max-width: 500px;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.02),
                rgba(255, 255, 255, 0.05)
            );
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
            opacity: 0;
            animation: fadeInScale 1s forwards 0.7s;
        }

        .audio-container::before {
            content: '';
            position: absolute;
            inset: -50%;
            background: conic-gradient(
                from 0deg at 50% 50%,
                transparent,
                var(--cosmic-accent),
                transparent
            );
            animation: spin 20s linear infinite;
            opacity: 0.05;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .audio-label {
            display: block;
            margin-bottom: 5px;
            color: var(--cosmic-accent);
            font-style: italic;
            font-size: 1.1em;
            position: relative;
            z-index: 1;
        }

        .audio-subtitle {
            display: block;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9em;
            position: relative;
            z-index: 1;
        }

        .audio-visual {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 4px;
            height: 40px;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        .audio-bar {
            width: 4px;
            background: linear-gradient(
                to top,
                var(--cosmic-accent),
                var(--cosmic-glow)
            );
            border-radius: 2px;
            transform-origin: bottom;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .audio-bar.playing {
            animation: wave 1s ease-in-out infinite;
        }

        .audio-bar:nth-child(1) { height: 35%; animation-delay: 0ms; }
        .audio-bar:nth-child(2) { height: 55%; animation-delay: 100ms; }
        .audio-bar:nth-child(3) { height: 45%; animation-delay: 200ms; }
        .audio-bar:nth-child(4) { height: 70%; animation-delay: 300ms; }
        .audio-bar:nth-child(5) { height: 50%; animation-delay: 400ms; }
        .audio-bar:nth-child(6) { height: 60%; animation-delay: 500ms; }
        .audio-bar:nth-child(7) { height: 40%; animation-delay: 600ms; }

        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }

        /* Creative Image Gallery */
        .memories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 150px);
            gap: 20px;
            margin: 50px auto;
            max-width: 900px;
            perspective: 1000px;
            opacity: 0;
            animation: fadeInScale 1s forwards 0.9s;
        }

        .memory-container {
            position: relative;
            transform-style: preserve-3d;
        }

        .memory-container.center {
            grid-column: 2;
            grid-row: 2;
        }

        .memory-container.top {
            grid-column: 2;
            grid-row: 1;
        }

        .memory-container.left {
            grid-column: 1;
            grid-row: 2;
        }

        .memory-container.right {
            grid-column: 3;
            grid-row: 2;
        }

        .memory {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1),
                        box-shadow 0.6s;
            box-shadow: 
                0 10px 40px rgba(138, 43, 226, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .memory::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                135deg,
                transparent 40%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 60%
            );
            transform: translateX(-100%);
            transition: transform 0.6s;
            z-index: 2;
        }

        .memory:hover::before {
            transform: translateX(100%);
        }

        .memory:hover {
            transform: translateZ(30px) scale(1.05);
            box-shadow: 
                0 20px 60px rgba(138, 43, 226, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .memory.center:hover {
            transform: translateZ(50px) scale(1.1);
        }

        .memory img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s, filter 0.6s;
        }

        .memory:hover img {
            transform: scale(1.1);
            filter: brightness(1.1);
        }

        /* Poem Title */
        h2 {
            font-size: 1.8em;
            text-align: center;
            margin: 60px 0 30px;
            color: var(--cosmic-text);
            font-style: italic;
            letter-spacing: 2px;
            opacity: 0;
            animation: fadeInScale 1s forwards 1.3s;
        }

        /* Letter */
        .letter {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.02),
                rgba(255, 255, 255, 0.04)
            );
            border-radius: 25px;
            padding: 50px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .letter::before {
            content: '';
            position: absolute;
            inset: -100%;
            background: radial-gradient(
                circle at var(--mouse-x) var(--mouse-y),
                rgba(138, 43, 226, 0.05),
                transparent 50%
            );
            pointer-events: none;
        }

        .letter p {
            line-height: 1.9;
            margin-bottom: 25px;
            font-size: 1.1em;
            color: var(--cosmic-text);
            position: relative;
            z-index: 1;
            opacity: 0;
            transform: translateY(20px);
        }

        .letter.visible p {
            animation: fadeUp 0.8s forwards;
        }

        @keyframes fadeUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .letter p:nth-child(1) { animation-delay: 0.1s; }
        .letter p:nth-child(2) { animation-delay: 0.2s; }
        .letter p:nth-child(3) { animation-delay: 0.3s; }
        .letter p:nth-child(4) { animation-delay: 0.4s; }
        .letter p:nth-child(5) { animation-delay: 0.5s; }
        .letter p:nth-child(6) { animation-delay: 0.6s; }
        .letter p:nth-child(7) { animation-delay: 0.7s; }
        .letter p:nth-child(8) { animation-delay: 0.8s; }

        .letter em {
            color: var(--cosmic-accent);
            font-style: normal;
            font-weight: 500;
            transition: all 0.3s;
        }

        .letter em:hover {
            color: white;
            text-shadow: 0 0 20px var(--cosmic-accent);
        }

        /* Birthday Wishes */
        .birthday-wishes {
            text-align: center;
            font-size: 1.5em;
            margin: 50px 0;
            font-weight: bold;
            background: linear-gradient(
                90deg,
                #ffd89b,
                var(--cosmic-accent),
                var(--cosmic-glow),
                var(--cosmic-accent),
                #ffd89b
            );
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 4s linear infinite;
            opacity: 0;
        }

        .birthday-wishes.visible {
            animation: fadeInScale 1s forwards, shimmer 4s linear infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 1.5em; }
            .letter { padding: 30px 20px; }
            
            .memories {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                gap: 15px;
                max-width: 350px;
            }
            
            .memory-container.center,
            .memory-container.top,
            .memory-container.left,
            .memory-container.right {
                grid-column: 1;
                grid-row: auto;
            }
            
            .memory {
                height: 250px;
            }

            .perf-stats {
                font-size: 8px;
                padding: 8px;
            }
        }

        @media print {
            * { animation: none !important; }
            .perf-stats { display: none; }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Performance Stats -->
    <div class="perf-stats" id="perfStats">
        <div><span class="metric">FPS:</span> <span class="value" id="fps">60</span></div>
        <div><span class="metric">Particles:</span> <span class="value" id="particleCount">0</span></div>
        <div><span class="metric">Memory:</span> <span class="value" id="memUsage">Loading...</span></div>
        <div><span class="metric">Vec2 Pool:</span> <span class="value" id="poolStats">0/0</span></div>
        <div><span class="metric">Mode:</span> <span class="value" id="renderMode">Init...</span></div>
        <div><span class="metric">Reduction:</span> <span class="value" id="reductionFactor">1.00</span></div>
    </div>

    <!-- Entry Overlay -->
    <div class="entry-overlay" id="entryOverlay">
        <div class="entry-content">
            <h2 class="entry-title">A Cosmic Birthday Journey</h2>
            <p class="entry-subtitle">Celebrating you among the stars</p>
            <button class="enter-button">Enter & Celebrate</button>
        </div>
    </div>

    <!-- Optimized Canvas Layers -->
    <canvas id="starCanvas"></canvas>
    <canvas id="orbCanvas"></canvas>
    <canvas id="trailCanvas"></canvas>
    <canvas id="sparkleCanvas"></canvas>

    <div class="container" id="mainContainer">
        <h1>A Birthday to My Lovely Girlfriend</h1>
        
        <!-- Birthday Date Display -->
        <div class="birthday-date">
            <div class="day">🎂 Happy Birthday 🎂</div>
            <div class="message">Today, the universe celebrates you</div>
        </div>
        
        <!-- Audio Player -->
        <div class="audio-container">
            <span class="audio-label">♪ Pisces - Tony Ann (Piano Cover) ♪</span>
            <span class="audio-subtitle">A melody for your special day</span>
            <div class="audio-visual" id="audioVisual">
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
            </div>
            <audio id="bgMusic" loop>
                <source src="Pisces - Tony Ann (Piano Cover).mp3" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>

        <!-- Creative Memory Gallery (Empty divs removed) -->
        <div class="memories">
            <!-- You can add your images here if you decide to: -->
            <!-- Example: -->
            <!-- <div class="memory-container top">
                <div class="memory" data-tilt>
                    <img src="path/to/your/image1.jpg" alt="Memory 1">
                </div>
            </div> -->
            <!-- Currently, the gallery will show colored backgrounds defined by the CSS. -->
        </div>

        <h2>To the Light of My Universe</h2>

        <div class="letter" id="letter">
            <p>Sky, on this day when the cosmos aligned to bring you into existence, I want you to know that your presence in this world—and in my life—is nothing short of extraordinary. You are a constellation of qualities that illuminate the darkness, a radiance that transforms ordinary moments into something cosmic and profound.</p>

            <p>Your beauty isn't merely what eyes can perceive, though that alone takes my breath away. It's in the essence of who you are—the warmth that radiates from your spirit, the kindness that flows as naturally as starlight across the void, the strength that anchors you even when storms gather. I see all of it, every facet, every dimension, and I am endlessly grateful to witness the universe through your presence.</p>

            <p>Every day with you is a celebration, but today holds special significance. Today marks another rotation around the sun, another year of your light brightening this world. Today, I want you to feel <em>cherished</em>, to feel <em>valued</em>, to feel <em>loved</em> in a way that transcends words typed on screens or whispered through the digital cosmos.</p>

            <p>You deserve the universe laid at your feet—galaxies of joy, nebulae of laughter, constellations of dreams realized. You deserve mornings painted with gold and evenings wrapped in stardust. You deserve every good thing this existence has to offer, and I hope this year brings you closer to everything your heart desires.</p>

            <p>Your passions, your dreams, your unique way of seeing the world—they all contribute to the beautiful soul you are. The way you pursue what brings you joy, the care you show to those around you, the gentle strength that defines you—these are the things that make you irreplaceable, unrepeatable, absolutely <em>you</em>.</p>

            <p>As you stand at this moment, another year wiser and more radiant, I want you to know that you are loved not for what you do or what you achieve, but simply for <em>being</em>. Your existence alone is a gift, a cosmic event worth celebrating across all the stars in the sky.</p>

            <p>May this year bring you adventures that ignite your spirit, quiet moments that bring you peace, laughter that echoes through your days, and love that wraps around you like a warm embrace. May you discover new facets of yourself, reach new heights in your journey, and find joy in both grand moments and simple pleasures.</p>

            <p>Happy birthday, my love. Today, the universe celebrates you, and so do I—with every beat of my heart, with every thought that drifts toward you, with every hope I hold for your happiness. You are extraordinary, you are cherished, and you are deeply, profoundly loved.</p>
        </div>

        <div class="birthday-wishes" id="birthdayWishes">
            With all my love, on your special day and always. ✨🎂💜
        </div>
    </div>

    <script>
        'use strict';

        // ============================================================
        // OPTIMIZED COSMIC BIRTHDAY - GUARANTEED TO WORK
        // ============================================================

        /**
         * Performance Monitor
         */
        const PerfMonitor = (() => {
            let frameCount = 0;
            let lastTime = performance.now();
            let fps = 60;
            let fpsHistory = [];
            
            return Object.freeze({
                update: () => {
                    frameCount++;
                    const now = performance.now();
                    if (now >= lastTime + 1000) {
                        fps = Math.round((frameCount * 1000) / (now - lastTime));
                        fpsHistory.push(fps);
                        if (fpsHistory.length > 10) fpsHistory.shift();
                        
                        frameCount = 0;
                        lastTime = now;
                        
                        const fpsEl = document.getElementById('fps');
                        if (fpsEl) fpsEl.textContent = fps;
                    }
                },
                getFPS: () => fps,
                getAvgFPS: () => {
                    if (fpsHistory.length === 0) return 60;
                    return fpsHistory.reduce((a, b) => a + b, 0) / fpsHistory.length;
                }
            });
        })();

        /**
         * Memory usage monitor
         */
        function getMemoryUsage() {
            if (performance.memory) {
                const used = Math.round(performance.memory.usedJSHeapSize / 1048576);
                const total = Math.round(performance.memory.totalJSHeapSize / 1048576);
                return `${used}/${total} MB`;
            }
            return 'N/A';
        }

        /**
         * Update performance stat display
         */
        function updatePerfStat(id, value, className = 'value') {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = value;
                el.className = className;
            }
        }

        /**
         * Immutable state container
         */
        const createState = (initialState) => {
            let state = Object.freeze({ ...initialState });
            const subscribers = new Set();
            
            return Object.freeze({
                get: () => state,
                
                update: (updater) => {
                    const newState = Object.freeze({
                        ...state,
                        ...(typeof updater === 'function' ? updater(state) : updater)
                    });
                    state = newState;
                    subscribers.forEach(fn => fn(newState));
                    return newState;
                },
                
                subscribe: (fn) => {
                    subscribers.add(fn);
                    return () => subscribers.delete(fn);
                },
                
                getField: (field) => state[field]
            });
        };

        /**
         * Vec2 class for 2D vector operations
         */
        class Vec2 {
            constructor(x = 0, y = 0) {
                this.x = x;
                this.y = y;
            }

            set(x, y) {
                this.x = x;
                this.y = y;
                return this;
            }

            lengthSq() {
                return this.x * this.x + this.y * this.y;
            }
        }

        /**
         * Vec2 Object Pool
         */
        class Vec2Pool {
            constructor(initialSize = 1000) {
                this.pool = new Array(
